<!DOCTYPE html> 
<html lang="en"> 
  <head> 
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width", initial-scale="1"/>
    <title>City Center Hotel Ticket Time Calculator</title>
    <style>
      body {text-align: center;}
      form {display: inline-block; text-align: right;}
      input {text-align: right;}
      debug {display: none;}
    </style>
  </head> 
  <body> 
    <h1>Hotel Ticket Time Calculator</h1>
    <form id="ticket" onsubmit="return calcTotal()">
      Validated
      <input type="text" id="end" size=16 maxlength=10 
        onblur="formatInput('end')" onfocus="restoreInput('end')" />
      <br />
      Printed
      <input type="text" id="start" size=16 maxlength=10 
        onblur="formatInput('start')" onfocus="restoreInput('start')"/>
      <br />
      <button type="submit" id="calc">Total</button>
      <input type="text" id="total" size=9 readonly="true" />
      <button type="reset" id="clear" ">Clear</button>
      <br />
      <input type="text" id="debug" size=32 readonly="true" />      
    </form>
    <script language="JavaScript" type="text/javascript">

      document.getElementById("ticket").onkeypress = keyPress;

      //calculate and display hours
      function calcTotal()
      {
        var startInput = document.getElementById("start");
        var endInput = document.getElementById("end");
        var totalInput = document.getElementById("total");

        var startDate = parseDateTime(startInput.value);
        var endDate = parseDateTime(endInput.value);
        var time = Math.abs(endDate - startDate);
        var hours = Math.ceil(time/3600000);
        
        totalInput.value = hours;
        
        return false;
      }

      //format input field with specified id
      function formatInput(id)
      {
        var input = document.getElementById(id);
        var entry = input.value;
        var formatted = "";
        if (entry.length) formatted = formatDateTime(entry);
        input.value = formatted; //display formatted text
        input.entry = entry; //save entered text
        //date = parseDateTime(formatted);
        //document.getElementById("debug").value = date.toString();
      }

      function keyPress(event)
      {
        var form = document.getElementById("ticket");
        var key = event.key;
        if (key == "Esc")
        {
          form.reset();
          return false;
        }
        return true;
      }

      //restore entered value into input field
      function restoreInput(id)
      {
        var input = document.getElementById(id);
        if (input.value.length && "entry" in input)
          input.value = input.entry;
      }

      function formatDateTime(text)
      {
        var now = new Date();
        var year = now.getFullYear();
        var month = now.getMonth() + 1; //convert to Calendar month
        var day = now.getDate();
        var hours = now.getHours();
        var minutes = now.getMinutes();
        var century = Math.floor(year/100) * 100;
        switch (text.length)
        {
          case 3:
            hours = parseInt(text.substring(0,1));
            minutes = parseInt(text.substring(1));
            break;
          case 4:
            hours = parseInt(text.substring(0,2));
            minutes = parseInt(text.substring(2));
            break;
          case 5:
            day = parseInt(text.substring(0,1));
            hours = parseInt(text.substring(1,3));
            minutes = parseInt(text.substring(3));
            break;
          case 6:
            day = parseInt(text.substring(0,2));
            hours = parseInt(text.substring(2,4));
            minutes = parseInt(text.substring(4));
            break;
          case 7:
            month = parseInt(text.substring(0,1));
            day = parseInt(text.substring(1,3));
            hours = parseInt(text.substring(3,5));
            minutes = parseInt(text.substring(5));
            break;
          case 8:
            month = parseInt(text.substring(0,2));
            day = parseInt(text.substring(2,4));
            hours = parseInt(text.substring(4,6));
            minutes = parseInt(text.substring(6));
            break;
          case 10:
            year = parseInt(text.substring(0,2)) + century;
            month = parseInt(text.substring(2,4));
            day = parseInt(text.substring(4,6));
            hours = parseInt(text.substring(6,8));
            minutes = parseInt(text.substring(8));
            break;
          default:
            minutes = NaN;
            break;
        } //switch
        var date = padInt(year) + "-" + padInt(month) + "-" + padInt(day);
        var time = padInt(hours) + ":" + padInt(minutes);
        return date + " " + time;
      }

      function padInt(i)
      {
        s = i.toString();
        return s.length < 2 ? "0" + s : s;
      }


  
      //convert "YYYY-MM-DD HH:MM" to Unix epoch
      function parseDateTime(text)
      {
        var year = parseInt(text.substring(0,4));
        var month = parseInt(text.substring(5,7));
        var day = parseInt(text.substring(8,10));
        var hours = parseInt(text.substring(11,13));
        var minutes = parseInt(text.substring(14));
        return new Date(year, month-1, day, hours, minutes, 0, 0);
      }
      
    </script>
  </body> 
</html>

